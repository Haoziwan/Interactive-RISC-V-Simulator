# RISC-V 模拟器项目文档

## 1. 项目概述

RISC-V 模拟器是一个基于 Web 的可视化 RISC-V 处理器模拟系统。该项目旨在帮助用户理解 RISC-V 处理器的工作原理，通过可视化的方式展示指令执行过程和数据通路的运作。

### 1.1 主要功能

- RISC-V 汇编代码编辑和编译
- 可视化数据通路设计和模拟
- 实时寄存器状态监控
- 内存读写操作可视化
- 单步执行和连续执行模式

### 1.2 技术栈

- 前端框架：React + TypeScript
- 状态管理：Zustand
- 可视化库：React Flow
- 构建工具：Vite
- 样式框架：Tailwind CSS

## 2. 系统架构

### 2.1 核心模块

1. **汇编器模块**
   - 支持 RISC-V 指令集的解析和编译
   - 实现 R、I、S、B、U、J 型指令的处理
   - 提供语法错误检查和提示

2. **数据通路模拟器**
   - 可视化展示处理器组件和连接
   - 支持组件拖拽和连线
   - 实时展示数据流动
   - 提供单步执行和连续执行功能

3. **状态管理系统**
   - 统一管理电路组件状态
   - 处理指令执行和数据更新
   - 维护寄存器和内存状态

### 2.2 数据流

1. **指令执行流程**
   - 汇编代码编译生成机器码
   - 加载指令到指令内存
   - 通过数据通路执行指令
   - 更新寄存器和内存状态

2. **组件交互流程**
   - 组件状态更新触发重渲染
   - 数据通过连线传递
   - 控制信号影响执行流程

## 3. 组件说明

### 3.1 核心组件

1. **指令内存 (InstructionMemoryNode)**
   - 存储编译后的机器码
   - 维护程序计数器（PC）
   - 提供指令读取接口

2. **寄存器文件 (RegisterFileNode)**
   - 管理 32 个通用寄存器
   - 支持并行读写操作
   - 实时显示寄存器状态

3. **ALU (ALUNode)**
   - 执行算术逻辑运算
   - 支持多种运算类型
   - 生成标志位输出

4. **控制单元 (ControlNode)**
   - 生成控制信号
   - 决定数据通路配置
   - 控制指令执行流程

### 3.2 状态管理

使用 Zustand 进行状态管理，主要包括：

```typescript
interface CircuitState {
  nodes: Node[];            // 电路组件节点
  edges: Edge[];            // 连线
  isSimulating: boolean;    // 模拟状态
  assembledInstructions: Array<{hex: string; binary: string}>; // 已编译指令
  // ... 其他状态
}
```

## 4. 开发指南

### 4.1 环境配置

1. **开发环境要求**
   - Node.js 16+
   - npm 8+

2. **项目设置**
   ```bash
   git clone <repository-url>
   cd riscv-simulator
   npm install
   npm run dev
   ```

### 4.2 项目结构

```
src/
├── assembler/        # RISC-V 汇编器实现
├── components/       # React 组件
│   ├── nodes/       # 数据通路节点组件
│   └── ...          # 其他UI组件
├── store/           # 状态管理
├── types/           # TypeScript 类型定义
└── utils/           # 工具函数
```

### 4.3 开发规范

1. **代码风格**
   - 使用 TypeScript 强类型
   - 遵循 React 最佳实践
   - 使用函数式组件和 Hooks

2. **组件开发**
   - 保持组件的单一职责
   - 使用 TypeScript 接口定义 props
   - 实现必要的错误处理

3. **状态管理**
   - 合理使用 Zustand store
   - 避免冗余的状态更新
   - 保持状态的一致性

## 5. 部署指南

### 5.1 构建

```bash
# 构建生产版本
npm run build

# 预览构建结果
npm run preview
```

### 5.2 部署检查清单

- [ ] 确保所有依赖已正确安装
- [ ] 验证构建输出的完整性
- [ ] 检查环境变量配置
- [ ] 测试主要功能的可用性

## 6. 常见问题

1. **组件连接问题**
   - 检查连线的起点和终点是否正确
   - 验证控制信号的配置

2. **指令执行异常**
   - 确认指令格式是否正确
   - 检查数据通路的完整性
   - 验证控制信号的正确性

3. **性能优化**
   - 减少不必要的状态更新
   - 优化组件重渲染
   - 合理使用 React.memo

## 7. 后续开发计划

1. **功能增强**
   - 支持更多 RISC-V 扩展指令
   - 添加流水线模式
   - 实现缓存模拟

2. **用户体验改进**
   - 优化界面交互
   - 添加更多调试功能
   - 提供更详细的执行日志

3. **文档完善**
   - 补充更多示例代码
   - 添加视频教程
   - 完善 API 文档